# Polyrhythm Player

ブラウザで動作するポリリズムプレイヤー。多角形ビジュアライザー付き。

**デモ:** https://coffeerumba.github.io/polyrhythm/

## 仕組み

スコアの各行が1つのボイスに対応します。ノートはカンマ区切りで記述します。1行あたりのノート数がその行の1周期あたりの発音回数を決定し、行ごとにノート数が異なることでポリリズムが生まれます。

周期 `t` はBPMから算出されます: `t = 240 / bpm`。各ボイスはこの周期をノート数で等分し（`t / p` 秒間隔）、順番にノートを鳴らします。

## スコアの書き方

```
C4,E4,G4
F3,A3
kick,hihat,snare,hihat
```

- **音程ノート** — `C4`, `F#3`, `Bb5` など（[tonal](https://github.com/tonaljs/tonal) で解釈）
- **打楽器** — `kick`, `snare`, `hihat`, `clap`, `tom`
- **混在** — 音程ノートと打楽器を同じ行に書ける
- **無音** — 認識できない文字列は休符として扱われる
- **空行** は無視される

## ビジュアライザー

各ボイスはノート数に応じた多角形として表示されます：

| ノート数 | 形状 |
|---------|------|
| 1 | 点 |
| 2 | 線 |
| 3 | 三角形 |
| 4 | 四角形 |
| n | 正n角形 |

再生に同期して点が多角形の頂点を周回し、ノートが鳴るタイミングでハイライトされます。

## 操作

- **BPMスライダー**（15〜300） — 再生速度をリアルタイムで調整
- **Play / Stop** — 再生・停止

スコアとBPMはlocalStorageに保存され、次回読み込み時に復元されます。

## 技術スタック

- [Tone.js](https://tonejs.github.io/) — オーディオスケジューリング・シンセサイザー
- [Tonal](https://github.com/tonaljs/tonal) — 音楽理論・ノート解析
- [jQuery](https://jquery.com/) — DOM操作
- Canvas 2D — ビジュアライザー描画

## ローカルで実行

`index.html` をブラウザで開くだけで動作します。ビルド不要です。
