<!DOCTYPE html>
<html>
<head><meta charset="UTF-8"><title>Piano WAV Generator</title></head>
<body style="background:#1a1a2e;color:#e0e0e0;font-family:sans-serif;padding:40px">
<h2>Piano WAV Generator</h2>
<p>Click the button to generate and download 12 piano note WAV files (C4â€“B4).</p>
<button id="go" style="padding:12px 24px;font-size:16px;cursor:pointer">Generate & Download All</button>
<pre id="log" style="margin-top:20px"></pre>
<script>
const NOTES = [
  { name: 'C4',  freq: 261.63 },
  { name: 'Cs4', freq: 277.18 },
  { name: 'D4',  freq: 293.66 },
  { name: 'Ds4', freq: 311.13 },
  { name: 'E4',  freq: 329.63 },
  { name: 'F4',  freq: 349.23 },
  { name: 'Fs4', freq: 369.99 },
  { name: 'G4',  freq: 392.00 },
  { name: 'Gs4', freq: 415.30 },
  { name: 'A4',  freq: 440.00 },
  { name: 'As4', freq: 466.16 },
  { name: 'B4',  freq: 493.88 },
];

const SAMPLE_RATE = 44100;
const DURATION = 2.0; // seconds

function synthesizePiano(freq, sampleRate, duration) {
  const len = Math.floor(sampleRate * duration);
  const buf = new Float32Array(len);

  // Piano-like: fundamental + harmonics with decreasing amplitude
  const harmonics = [
    { n: 1, amp: 1.0,  decay: 2.0 },
    { n: 2, amp: 0.5,  decay: 2.5 },
    { n: 3, amp: 0.25, decay: 3.0 },
    { n: 4, amp: 0.15, decay: 3.5 },
    { n: 5, amp: 0.08, decay: 4.0 },
    { n: 6, amp: 0.04, decay: 4.5 },
  ];

  for (let i = 0; i < len; i++) {
    const t = i / sampleRate;
    let sample = 0;
    for (const h of harmonics) {
      const f = freq * h.n;
      if (f > sampleRate / 2) continue; // Nyquist
      const env = h.amp * Math.exp(-h.decay * t);
      sample += env * Math.sin(2 * Math.PI * f * t);
    }
    // Quick attack envelope (5ms)
    const attack = Math.min(1, t / 0.005);
    buf[i] = sample * attack;
  }

  // Normalize to [-0.9, 0.9]
  let peak = 0;
  for (let i = 0; i < len; i++) peak = Math.max(peak, Math.abs(buf[i]));
  if (peak > 0) {
    const scale = 0.9 / peak;
    for (let i = 0; i < len; i++) buf[i] *= scale;
  }

  return buf;
}

function floatToWav(samples, sampleRate) {
  const numSamples = samples.length;
  const bytesPerSample = 2; // 16-bit
  const blockAlign = bytesPerSample;
  const dataSize = numSamples * bytesPerSample;
  const buffer = new ArrayBuffer(44 + dataSize);
  const view = new DataView(buffer);

  function writeStr(offset, str) {
    for (let i = 0; i < str.length; i++) view.setUint8(offset + i, str.charCodeAt(i));
  }

  writeStr(0, 'RIFF');
  view.setUint32(4, 36 + dataSize, true);
  writeStr(8, 'WAVE');
  writeStr(12, 'fmt ');
  view.setUint32(16, 16, true);           // fmt chunk size
  view.setUint16(20, 1, true);            // PCM
  view.setUint16(22, 1, true);            // mono
  view.setUint32(24, sampleRate, true);
  view.setUint32(28, sampleRate * blockAlign, true);
  view.setUint16(32, blockAlign, true);
  view.setUint16(34, 16, true);           // bits per sample
  writeStr(36, 'data');
  view.setUint32(40, dataSize, true);

  for (let i = 0; i < numSamples; i++) {
    const s = Math.max(-1, Math.min(1, samples[i]));
    view.setInt16(44 + i * 2, s < 0 ? s * 0x8000 : s * 0x7FFF, true);
  }

  return new Blob([buffer], { type: 'audio/wav' });
}

function downloadBlob(blob, filename) {
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = filename;
  a.click();
  URL.revokeObjectURL(a.href);
}

const log = document.getElementById('log');
document.getElementById('go').addEventListener('click', async () => {
  document.getElementById('go').disabled = true;
  for (const note of NOTES) {
    log.textContent += `Generating ${note.name} (${note.freq} Hz)...\n`;
    await new Promise(r => setTimeout(r, 50)); // let UI update
    const samples = synthesizePiano(note.freq, SAMPLE_RATE, DURATION);
    const wav = floatToWav(samples, SAMPLE_RATE);
    downloadBlob(wav, note.name + '.wav');
    log.textContent += `  -> ${note.name}.wav downloaded\n`;
    await new Promise(r => setTimeout(r, 200)); // stagger downloads
  }
  log.textContent += '\nDone! All 12 files generated.\n';
});
</script>
</body>
</html>
